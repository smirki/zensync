<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Chat Interface</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.2/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!--
// v0 by Vercel.
// https://v0.dev/t/8cVP7rRluIZ
-->

    <style>
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Inter", sans-serif;
        --font-sans: "Inter";
      }
    </style>
    <style>
      body {
        font-family: "Inter", sans-serif;
        --font-sans: "Inter";
      }
    </style>
    <div class="flex h-screen w-full dark:bg-gray-900 dark:text-gray-50">
      <div
        class="bg-white dark:bg-gray-800 w-full max-w-[800px] border-r border-gray-200 dark:border-gray-700 flex flex-col"
      >
        <div
          class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"
        >
          <div class="flex items-center gap-4">
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
              >
                <path d="m15 18-6-6 6-6"></path>
              </svg>
              <span class="sr-only">Previous Month</span>
            </button>
            <div class="text-lg font-medium">April 2023</div>
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
              >
                <path d="m9 18 6-6-6-6"></path>
              </svg>
              <span class="sr-only">Next Month</span>
            </button>
          </div>
          <div class="flex items-center gap-4">
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
              >
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                <line x1="16" x2="16" y1="2" y2="6"></line>
                <line x1="8" x2="8" y1="2" y2="6"></line>
                <line x1="3" x2="21" y1="10" y2="10"></line>
                <path d="M8 14h.01"></path>
                <path d="M12 14h.01"></path>
                <path d="M16 14h.01"></path>
                <path d="M8 18h.01"></path>
                <path d="M12 18h.01"></path>
                <path d="M16 18h.01"></path>
              </svg>
              <span class="sr-only">Go to Today</span>
            </button>
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
              >
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                <line x1="16" x2="16" y1="2" y2="6"></line>
                <line x1="8" x2="8" y1="2" y2="6"></line>
                <line x1="3" x2="21" y1="10" y2="10"></line>
              </svg>
              <span class="sr-only">Open Calendar</span>
            </button>
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
              >
                <path
                  d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                ></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <span class="sr-only">Calendar Settings</span>
            </button>
          </div>
        </div>
        <div class="grid grid-cols-7 gap-px bg-gray-200 dark:bg-gray-700">
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Sun
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Mon
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Tue
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Wed
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Thu
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Fri
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            Sat
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            28
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            29
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400"
          >
            30
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-50 bg-gray-100 dark:bg-gray-700"
          >
            1
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-50"
          >
            2
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-50"
          >
            3
          </div>
          <div
            class="bg-white dark:bg-gray-800 px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-50"
          >
            4
          </div>
        </div>
        <div class="flex-1 overflow-y-auto">
          <div id="events" class="p-6 space-y-6">
          </div>
          <div class="p-6 space-y-6">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-medium">Contacts</h2>
              <div class="relative w-full max-w-md">
                <input
                  class="flex h-10 w-full rounded-md border px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-10 bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-50"
                  placeholder="Search contacts..."
                  type="search"
                />
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 dark:text-gray-400"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.3-4.3"></path>
                </svg>
              </div>
            </div>
            <div
              id="contacts"
              class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
            ></div>
          </div>
        </div>
      </div>
      <div
        class="bg-gray-100 dark:bg-gray-700 flex-1 flex flex-col"
        data-id="117"
      >
        <div
          class="border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between"
          data-id="118"
        >
          <div class="flex items-center gap-4" data-id="119">
            <span
              class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"
              data-id="120"
              ><img
                class="aspect-square h-full w-full"
                alt="You"
                data-id="121"
                src="https://generated.vusercontent.net/placeholder-user.jpg"
            /></span>
            <div data-id="123">
              <div class="font-medium" data-id="124">You</div>
              <div
                class="text-sm text-gray-500 dark:text-gray-400"
                data-id="125"
              >
                Online
              </div>
            </div>
          </div>
          <div class="flex items-center gap-4" data-id="126">
            <button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
              data-id="127"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
                data-id="128"
              >
                <path
                  d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"
                ></path></svg
              ><span class="sr-only" data-id="129">Attach File</span></button
            ><button
              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10"
              data-id="130"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-5 h-5"
                data-id="131"
              >
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="19" cy="12" r="1"></circle>
                <circle cx="5" cy="12" r="1"></circle></svg
              ><span class="sr-only" data-id="132">More Options</span>
            </button>
          </div>
        </div>
        <div id="messages" class="flex-1 overflow-y-auto p-6 space-y-4" data-id="133">
          <div class="flex items-start space-x-4" data-id="400">
            <span
              class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"
              data-id="135"
              ><img
                class="aspect-square h-full w-full"
                alt="AI"
                data-id="136"
                src="https://via.placeholder.com/placeholder-user.jpg"
            /></span>
            <div
              class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 max-w-[70%]"
              data-id="138"
            >
              <p class="text-gray-900 dark:text-gray-50" data-id="139">
                Hello, how can I assist you today?
              </p>
            </div>
          </div>
          <div class="flex items-start space-x-4 justify-end" data-id="140">
            <div
              class="bg-gray-900 dark:bg-gray-50 rounded-lg p-4 max-w-[70%] text-gray-50 dark:text-gray-900"
              data-id="141"
            >
              <p data-id="142">I'd like to discuss the new project proposal.</p>
            </div>
            <span
              class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"
              data-id="143"
              ><img
                class="aspect-square h-full w-full"
                alt="You"
                data-id="144"
                src="https://generated.vusercontent.net/placeholder-user.jpg"
            /></span>
          </div>
          <div class="flex items-start space-x-4" data-id="146">
            <span
              class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"
              data-id="147"
              ><img
                class="aspect-square h-full w-full"
                alt="AI"
                data-id="148"
                src="https://generated.vusercontent.net/placeholder-user.jpg"
            /></span>
            <div
              class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 max-w-[70%]"
              data-id="150"
            >
              <p class="text-gray-900 dark:text-gray-50" data-id="151">
                Sure, let's go over the details of the proposal.
              </p>
            </div>
          </div>
        </div>
        <div
          class="border-t border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center"
          data-id="152"
        >
          <textarea
            id="chatbox"
            class="flex h-10 w-full rounded-md border px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 flex-1 mr-4 bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-50"
            placeholder="Type your message..."
            data-id="153"
          ></textarea><button
            class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 bg-gray-900 dark:bg-gray-50 text-white dark:text-gray-900"
            data-id="154"
          >
            Send
          </button>
        </div>
      </div>
    </div>
    <div
      id="modal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
    >
      <div class="bg-white p-4 rounded shadow-lg">
        <h2 class="font-bold text-lg">Error</h2>
        <p class="my-4" id="modalText">An error occurred. Please try again.</p>
        <div class="flex justify-end">
          <button
            onclick="closeModal()"
            class="bg-gray-300 hover:bg-gray-400 text-black py-2 px-4 rounded mr-2"
          >
            Close
          </button>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let globalCommand = '';
        let data = {
            messages: [],
            contacts: [],
            events: []
        };
    
        function confirmCommand() {
            globalCommand = $('#chatbox').val();
            
            let userInput = $('#chatbox').val();
            if (userInput.trim() !== '') {
                let message = {
                    text: userInput,
                    sender: 'user'
                };
                data.messages.push(message); // Add message to the global data object
                updateUI(data); // Update UI with current data
                sendCommand();
                $('#chatbox').val(''); // Clear the chatbox
            }
        }
    
        function handleKeyPress(event) {
            console.log("Key pressed: ", event.keyCode);
            if (event.keyCode === 13) { // Enter key
                event.preventDefault();
                confirmCommand();
            }
        }
    
        function sendCommand() {
          console.log("Sending command: ", globalCommand);
          $.ajax({
              url: '/ai',
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({ command: globalCommand }),
              success: function(response) {
                  console.log("Command successful: ", response);
                  console.log("Received data: ", response);
                  $('#chatbox').val('');
                  updateUI(response); // Ensure 'response' contains 'contacts', 'events', 'messages'
              },
              error: function(jqXHR, textStatus, errorThrown) {
                  console.error("AJAX error: ", textStatus, errorThrown);
                  $('#modalText').text('Failed to send command. Please try again.');
                  $('#modal').removeClass('hidden');
              }
          });
      }
    
      function updateUI(data) {
        console.log("Updating UI with data: ", data);
        let contactsDiv = $('#contacts');
        let eventsDiv = $('#events');
        let messagesDiv = $('#messages');
    
        // Clear existing content
        contactsDiv.empty();
        eventsDiv.empty();
        messagesDiv.empty();
    
        // Append new contacts
        if (data.contacts && Array.isArray(data.contacts)) {
            data.contacts.forEach(contact => {
                contactsDiv.append(`
                    <div class="flex items-center p-2 bg-white rounded shadow my-1">
                        <img src="${contact.image || 'https://via.placeholder.com/50'}" class="rounded-full mr-3">
                        <div>
                            <strong>${contact.name}</strong><br>
                            <span class="text-sm text-gray-500">${contact.info || ''}</span>
                        </div>
                    </div>
                `);
            });
        } else {
            console.log("No contacts data or not an array");
        }
    
        // Append new messages
        if (data.messages && Array.isArray(data.messages)) {
            data.messages.forEach(msg => {
                let messageHTML = msg["from"] === 'user' ? `
                    <div class="flex items-start justify-end space-x-reverse space-x-4">
                        <div class="bg-black rounded-lg p-4 max-w-[70%] text-white">
                            <p>${msg.text}</p>
                        </div>
                        <span class="flex h-10 w-10 shrink-0 overflow-hidden rounded-full">
                            <img class="aspect-square h-full w-full" alt="User" src="https://generated.vusercontent.net/placeholder-user.jpg" />
                        </span>
                    </div>` : `
                    <div class="flex items-start space-x-4">
                        <span class="flex h-10 w-10 shrink-0 overflow-hidden rounded-full">
                            <img class="aspect-square h-full w-full" alt="AI" src="https://generated.vusercontent.net/placeholder-user.jpg" />
                        </span>
                        <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 max-w-[70%] text-gray-900 dark:text-gray-50">
                            <p>${msg.text}</p>
                        </div>
                    </div>`;
                messagesDiv.append(messageHTML);
            });
        } else {
            console.log("No messages data or not an array");
        }
    
        // Append new events
        if (data.events && Array.isArray(data.events)) {
            data.events.forEach((event, index) => {
                eventsDiv.append(`
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-full bg-gray-900 dark:bg-gray-50 flex items-center justify-center text-white dark:text-gray-900 font-medium">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-medium">${event.title}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${event.starttime} - ${event.endtime}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Location: ${event.location || 'N/A'}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Attendees: ${event.attendees.join(', ')}</div>
                        </div>
                    </div>
                `);
            });
        } else {
            console.log("No events data or not an array");
        }
    }
    
    $("#chatbox").on("keypress", handleKeyPress);
    $("button[data-id='154']").on("click", confirmCommand);
    });
    

</script>
</body>
</html>